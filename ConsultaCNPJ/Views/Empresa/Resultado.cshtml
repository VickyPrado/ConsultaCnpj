@model List<ConsultaCNPJ.Models.Empresa>

@{
    Layout = "~/Views/Shared/Layout.cshtml";
}

<div class="resultado">
    @if (TempData["Erro"] != null)
    {
        <p class="erro">@TempData["Erro"]</p>
    }

    @if (Model != null && Model.Any())
    {
        var empresas = Model;

        foreach (var empresa in empresas)
        {
            <h2>Dados da empresa</h2>
            <p><b>CNPJ:</b> @(empresa.Cnpj ?? "N/A") - @(empresa.Tipo ?? "N/A")</p>
            <p><b>Nome:</b> @(empresa.Nome ?? "N/A")</p>
            <p><b>Abertura:</b> @(empresa.Abertura ?? "N/A")</p>
            <p><b>Endereço:</b> @(empresa.Logradouro ?? ""), @(empresa.Numero ?? "") - @(empresa.Bairro ?? ""), @(empresa.Municipio ?? "")/@(empresa.Uf ?? "") - @(empresa.Cep ?? "N/A")</p>
            <p><b>Telefone:</b> @(empresa.Telefone ?? "N/A")</p>
            <p><b>Email:</b> @(empresa.Email ?? "N/A")</p>

            string capitalSocialFormatado = "N/A";
            if (!string.IsNullOrEmpty(empresa.CapitalSocial) && decimal.TryParse(empresa.CapitalSocial, System.Globalization.NumberStyles.Any, System.Globalization.CultureInfo.InvariantCulture, out decimal capitalSocial))
            {
                capitalSocialFormatado = $"R$ {capitalSocial.ToString("N2", new System.Globalization.CultureInfo("pt-BR"))}";
            }
            <p><b>Capital Social:</b> @capitalSocialFormatado</p>
            <p><b>Simples Nacional:</b> @(empresa.SimplesNacional ?? "N/A")</p>
            <p><b>MEI:</b> @(empresa.Mei ?? "N/A")</p>
            <p><b>Situação Cadastral:</b> @(empresa.SituacaoCadastral ?? "N/A")</p>
            <p><b>Data da Situação Cadastral:</b> @(empresa.DataSituaçãoCadastral ?? "N/A")</p>
            <p><b>Natureza Jurídica:</b> @(empresa.NaturezaJurídica ?? "N/A")</p>
            <p><b>Atividade Econômica Primária:</b> @(empresa.AtividadePrincipal?.FirstOrDefault()?.Text ?? "N/A") (@(empresa.AtividadePrincipal?.FirstOrDefault()?.Code ?? "N/A"))</p>

            <h3>Atividades Econômicas Secundárias</h3>
            <ul>
                @foreach (var atividade in empresa.AtividadesSecundarias ?? new List<ConsultaCNPJ.Models.Atividade>())
                {
                    <li>@(atividade.Text ?? "N/A") (@(atividade.Code ?? "N/A"))</li>
                }
            </ul>

            <h3>Quadro de Sócios</h3>
            <ul>
                @foreach (var socio in empresa.Qsa ?? new List<ConsultaCNPJ.Models.Socio>())
                {
                    <li>@(socio.Nome ?? "N/A") - @(socio.Qual ?? "N/A")</li>
                }
            </ul>

            @if (empresas.Count > 1)
            {
                <hr />
            }
        }

        <form method="post" asp-action="Salvar" target="_self">
            @{
                var jsonEmpresas = Newtonsoft.Json.JsonConvert.SerializeObject(empresas);
            }
            <input type="hidden" name="empresas" value="@jsonEmpresas" />
            <label><strong>Escolha como salvar:</strong></label>
            <select name="formato">
                <option value="site">Salvar no site</option>
                <option value="txt">Salvar como TXT</option>
                <option value="pdf">Salvar como PDF</option>
            </select>
            <button type="submit">Salvar @(empresas.Count > 1 ? "Todas" : "")</button>
        </form>
    }
    else
    {
        <p>Nenhuma empresa encontrada.</p>
    }

    <a href="/Empresa/Consultar"><strong>Nova Consulta</strong></a>
</div>